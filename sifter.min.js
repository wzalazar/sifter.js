/*! sifter.js | https://github.com/brianreavis/sifter.js | Apache License (v2) */
(function(r,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{r.Sifter=t()}})(this,function(){var r=function(r,t){this.items=r;this.settings=t||{diacritics:true}};r.prototype.tokenize=function(r){r=n(String(r||"").toLowerCase());if(!r||!r.length)return[];var t,e,o,f;var u=[];var a=r.split(this.settings.tokenizePattern||/ +/);for(t=0,e=a.length;t<e;t++){o=i(a[t]);if(this.settings.diacritics){for(f in s){if(s.hasOwnProperty(f)){o=o.replace(new RegExp(f,"g"),s[f])}}}u.push({string:a[t],regex:new RegExp(o,"i")})}return u};r.prototype.iterator=function(r,t){var e;if(o(r)){e=Array.prototype.forEach||function(r){for(var t=0,e=this.length;t<e;t++){r(this[t],t,this)}}}else{e=function(r){for(var t in this){if(this.hasOwnProperty(t)){r(this[t],t,this)}}}}e.apply(r,[t])};r.prototype.getScoreFunction=function(r,t){var e,n,i,o;e=this;r=e.prepareSearch(r,t);i=r.tokens;n=r.options.fields;o=i.length;var s=function(r,t,e){var n,i;if(!r)return 0;r=String(r||"");i=r.search(t.regex);if(i===-1){return 0}n=t.string.length/r.length;if(e.options.sortMatchFirst){return e.maxPos-i}if(i===0){n+=.5}return n};var f=_.bind(function(){var r=this;var t=n.length;if(!t){return function(){return 0}}if(t===1){return function(t,e){return s(e[n[0]],t,r.sifter)}}return function(e,i){for(var o=0,f=0;o<t;o++){f+=s(i[n[o]],e,r.sifter)}return f/t}},{sifter:this})();if(!o){return function(){return 0}}if(o===1){return function(r){return f(i[0],r)}}if(r.options.conjunction==="and"){return function(r){var t;for(var e=0,n=0;e<o;e++){t=f(i[e],r);if(t<=0)return 0;n+=t}return n/o}}else{return function(r){for(var t=0,e=0;t<o;t++){e+=f(i[t],r)}return e/o}}};r.prototype.getSortFunction=function(r,e){var n,i,o,s,f,u,a,c,p,h,l;o=this;r=o.prepareSearch(r,e);l=!r.query&&e.sort_empty||e.sort;p=function(r,t){if(r==="$score")return t.score;return o.items[t.id][r]};f=[];if(l){for(n=0,i=l.length;n<i;n++){if(r.query||l[n].field!=="$score"){f.push(l[n])}}}if(r.query){h=true;for(n=0,i=f.length;n<i;n++){if(f[n].field==="$score"){h=false;break}}if(h){f.unshift({field:"$score",direction:"desc"})}}else{for(n=0,i=f.length;n<i;n++){if(f[n].field==="$score"){f.splice(n,1);break}}}c=[];for(n=0,i=f.length;n<i;n++){c.push(f[n].direction==="desc"?-1:1)}u=f.length;if(!u){return null}else if(u===1){s=f[0].field;a=c[0];return function(r,e){return a*t(p(s,r),p(s,e))}}else{return function(r,e){var n,i,o,s,a;for(n=0;n<u;n++){a=f[n].field;i=c[n]*t(p(a,r),p(a,e));if(i)return i}return 0}}};r.prototype.prepareSearch=function(r,t){if(typeof r==="object")return r;t=e({},t);var n=t.fields;var i=t.sort;var s=t.sort_empty;if(n&&!o(n))t.fields=[n];if(i&&!o(i))t.sort=[i];if(s&&!o(s))t.sort_empty=[s];return{options:t,query:String(r||"").toLowerCase(),tokens:this.tokenize(r),total:0,items:[]}};r.prototype.sortMatchFirst=function(r,t){if(r.length){var e=_.chain(r).sortBy(function(r){return _.unescape(r[t]).length}).pluck(t).last().value().length;return _.map(r,function(r){r[t]=_.padRight(r[t],parseInt(e)," ");return r})}};r.prototype.getMaxPos=function(r,t,e){var n=0;_.each(r,function(r){if(r[t].search(e.tokens[0].regex)>n){n=r[t].search(e.tokens[0].regex)}});return n};r.prototype.search=function(r,t){var e=this,n,i,o,s;var f;var u;o=this.prepareSearch(r,t);t=o.options;r=o.query;u=t.score||e.getScoreFunction(o);if(r.length){this.options=t;if(t.sortMatchFirst){var a=t.sortMatchFirst.field;this.maxPos=e.getMaxPos(e.items,a,o);e.sortMatchFirst(e.items,a)}e.iterator(e.items,function(r,e){i=u(r);if(t.filter===false||i>0){o.items.push({score:i,id:e})}})}else{e.iterator(e.items,function(r,t){o.items.push({score:1,id:t})})}f=e.getSortFunction(o,t);if(f)o.items.sort(f);o.total=o.items.length;if(typeof t.limit==="number"){o.items=o.items.slice(0,t.limit)}return o};var t=function(r,t){if(typeof r==="number"&&typeof t==="number"){return r>t?1:r<t?-1:0}r=f(String(r||""));t=f(String(t||""));if(r>t)return 1;if(t>r)return-1;return 0};var e=function(r,t){var e,n,i,o;for(e=1,n=arguments.length;e<n;e++){o=arguments[e];if(!o)continue;for(i in o){if(o.hasOwnProperty(i)){r[i]=o[i]}}}return r};var n=function(r){return(r+"").replace(/^\s+|\s+$|/g,"")};var i=function(r){return(r+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var o=Array.isArray||$&&$.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};var s={a:"[a\xc0\xc1\xc2\xc3\xc4\xc5\xe0\xe1\xe2\xe3\xe4\xe5\u0100\u0101\u0105\u0104]",c:"[c\xc7\xe7\u0107\u0106\u010d\u010c]",d:"[d\u0111\u0110\u010f\u010e]",e:"[e\xc8\xc9\xca\xcb\xe8\xe9\xea\xeb\u011b\u011a\u0112\u0113\u0119\u0118]",i:"[i\xcc\xcd\xce\xcf\xec\xed\xee\xef\u012a\u012b]",l:"[l\u0142\u0141]",n:"[n\xd1\xf1\u0148\u0147\u0144\u0143]",o:"[o\xd2\xd3\xd4\xd5\xd5\xd6\xd8\xf2\xf3\xf4\xf5\xf6\xf8\u014c\u014d]",r:"[r\u0159\u0158]",s:"[s\u0160\u0161\u015b\u015a]",t:"[t\u0165\u0164]",u:"[u\xd9\xda\xdb\xdc\xf9\xfa\xfb\xfc\u016f\u016e\u016a\u016b]",y:"[y\u0178\xff\xfd\xdd]",z:"[z\u017d\u017e\u017c\u017b\u017a\u0179]"};var f=function(){var r,t,e,n;var i="";var o={};for(e in s){if(s.hasOwnProperty(e)){n=s[e].substring(2,s[e].length-1);i+=n;for(r=0,t=n.length;r<t;r++){o[n.charAt(r)]=e}}}var f=new RegExp("["+i+"]","g");return function(r){return r.replace(f,function(r){return o[r]}).toLowerCase()}}();return r});