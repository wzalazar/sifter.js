/*! sifter.js | https://github.com/brianreavis/sifter.js | Apache License (v2) */
(function(t,r){if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.Sifter=r()}})(this,function(){var t=function(t,r){this.items=t;this.settings=r||{diacritics:true}};t.prototype.tokenize=function(t){t=n(String(t||"").toLowerCase());if(!t||!t.length)return[];var r,e,o,f;var u=[];debugger;var a=t.split(this.settings.tokenizePattern?/this.settings.tokenizePattern+/:/ +/);for(r=0,e=a.length;r<e;r++){o=i(a[r]);if(this.settings.diacritics){for(f in s){if(s.hasOwnProperty(f)){o=o.replace(new RegExp(f,"g"),s[f])}}}u.push({string:a[r],regex:new RegExp(o,"i")})}return u};t.prototype.iterator=function(t,r){var e;if(o(t)){e=Array.prototype.forEach||function(t){for(var r=0,e=this.length;r<e;r++){t(this[r],r,this)}}}else{e=function(t){for(var r in this){if(this.hasOwnProperty(r)){t(this[r],r,this)}}}}e.apply(t,[r])};t.prototype.getScoreFunction=function(t,r){var e,n,i,o;e=this;t=e.prepareSearch(t,r);i=t.tokens;n=t.options.fields;o=i.length;var s=function(t,r,e){var n,i;if(!t)return 0;t=String(t||"");i=t.search(r.regex);if(i===-1){return 0}n=r.string.length/t.length;if(i===0){n+=.5}if(e.options.sortMatchFirst){return n+(e.maxPos-i)}return n};var f=_.bind(function(){var t=this;var r=n.length;if(!r){return function(){return 0}}if(r===1){return function(r,e){return s(e[n[0]],r,t.sifter)}}return function(e,i){for(var o=0,f=0;o<r;o++){f+=s(i[n[o]],e,t.sifter)}return f/r}},{sifter:this})();if(!o){return function(){return 0}}if(o===1){return function(t){return f(i[0],t)}}if(t.options.conjunction==="and"){return function(t){var r;for(var e=0,n=0;e<o;e++){r=f(i[e],t);if(r<=0)return 0;n+=r}return n/o}}else{return function(t){for(var r=0,e=0;r<o;r++){e+=f(i[r],t)}return e/o}}};t.prototype.getSortFunction=function(t,e){var n,i,o,s,f,u,a,c,p,h,l;o=this;t=o.prepareSearch(t,e);l=!t.query&&e.sort_empty||e.sort;p=function(t,r){if(t==="$score")return r.score;return o.items[r.id][t]};f=[];if(l){for(n=0,i=l.length;n<i;n++){if(t.query||l[n].field!=="$score"){f.push(l[n])}}}if(t.query){h=true;for(n=0,i=f.length;n<i;n++){if(f[n].field==="$score"){h=false;break}}if(h){f.unshift({field:"$score",direction:"desc"})}}else{for(n=0,i=f.length;n<i;n++){if(f[n].field==="$score"){f.splice(n,1);break}}}c=[];for(n=0,i=f.length;n<i;n++){c.push(f[n].direction==="desc"?-1:1)}u=f.length;if(!u){return null}else if(u===1){s=f[0].field;a=c[0];return function(t,e){return a*r(p(s,t),p(s,e))}}else{return function(t,e){var n,i,o,s,a;for(n=0;n<u;n++){a=f[n].field;i=c[n]*r(p(a,t),p(a,e));if(i)return i}return 0}}};t.prototype.prepareSearch=function(t,r){if(typeof t==="object")return t;r=e({},r);var n=r.fields;var i=r.sort;var s=r.sort_empty;if(n&&!o(n))r.fields=[n];if(i&&!o(i))r.sort=[i];if(s&&!o(s))r.sort_empty=[s];return{options:r,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}};t.prototype.sortMatchFirst=function(t,r){var e=_.chain(t).sortBy(function(t){return _.unescape(t[r]).length}).pluck(r).last().value().length;return _.map(t,function(t){t[r]=_.padRight(t[r],parseInt(e)," ");return t})};t.prototype.getMaxPos=function(t,r,e){var n=0;_.each(t,function(t){if(t[r].search(e.tokens[0].regex)>n){n=t[r].search(e.tokens[0].regex)}});return n};t.prototype.search=function(t,r){var e=this,n,i,o,s;var f;var u;o=this.prepareSearch(t,r);r=o.options;t=o.query;u=r.score||e.getScoreFunction(o);if(t.length){this.options=r;if(r.sortMatchFirst){var a=r.sortMatchFirst.field;this.maxPos=e.getMaxPos(e.items,a,o);e.sortMatchFirst(e.items,a)}e.iterator(e.items,function(t,e){i=u(t);if(r.filter===false||i>0){o.items.push({score:i,id:e})}})}else{e.iterator(e.items,function(t,r){o.items.push({score:1,id:r})})}f=e.getSortFunction(o,r);if(f)o.items.sort(f);o.total=o.items.length;if(typeof r.limit==="number"){o.items=o.items.slice(0,r.limit)}return o};var r=function(t,r){if(typeof t==="number"&&typeof r==="number"){return t>r?1:t<r?-1:0}t=f(String(t||""));r=f(String(r||""));if(t>r)return 1;if(r>t)return-1;return 0};var e=function(t,r){var e,n,i,o;for(e=1,n=arguments.length;e<n;e++){o=arguments[e];if(!o)continue;for(i in o){if(o.hasOwnProperty(i)){t[i]=o[i]}}}return t};var n=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")};var i=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var o=Array.isArray||$&&$.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};var s={a:"[a\xc0\xc1\xc2\xc3\xc4\xc5\xe0\xe1\xe2\xe3\xe4\xe5\u0100\u0101\u0105\u0104]",c:"[c\xc7\xe7\u0107\u0106\u010d\u010c]",d:"[d\u0111\u0110\u010f\u010e]",e:"[e\xc8\xc9\xca\xcb\xe8\xe9\xea\xeb\u011b\u011a\u0112\u0113\u0119\u0118]",i:"[i\xcc\xcd\xce\xcf\xec\xed\xee\xef\u012a\u012b]",l:"[l\u0142\u0141]",n:"[n\xd1\xf1\u0148\u0147\u0144\u0143]",o:"[o\xd2\xd3\xd4\xd5\xd5\xd6\xd8\xf2\xf3\xf4\xf5\xf6\xf8\u014c\u014d]",r:"[r\u0159\u0158]",s:"[s\u0160\u0161\u015b\u015a]",t:"[t\u0165\u0164]",u:"[u\xd9\xda\xdb\xdc\xf9\xfa\xfb\xfc\u016f\u016e\u016a\u016b]",y:"[y\u0178\xff\xfd\xdd]",z:"[z\u017d\u017e\u017c\u017b\u017a\u0179]"};var f=function(){var t,r,e,n;var i="";var o={};for(e in s){if(s.hasOwnProperty(e)){n=s[e].substring(2,s[e].length-1);i+=n;for(t=0,r=n.length;t<r;t++){o[n.charAt(t)]=e}}}var f=new RegExp("["+i+"]","g");return function(t){return t.replace(f,function(t){return o[t]}).toLowerCase()}}();return t});